<section class="vp-page" *ngIf="!loading(); else loadingTpl">
  <ng-container *ngIf="!error(); else errTpl">

    <article class="vp-card" *ngIf="data() as p">
      <header class="vp-head">
        <div class="vp-title">
          <h1>{{ p.name || 'Profile' }}</h1>
          <p class="vp-sub" *ngIf="p.city || p.state">
            {{ p.city }}<span *ngIf="p.city && p.state">, </span>{{ p.state }}
          </p>
        </div>

<div class="settings-wrapper" *ngIf="isOwner()">
  <button
    type="button"
    class="settings-btn"
    (click)="toggleMenu($event)"
    aria-label="Profile settings"
    title="Profile settings"
  >
    <img
      src="/assets/images/settings-icon.png"
      class="vp-settings-img"
      alt="settings"
    />
  </button>

  <div class="settings-menu" *ngIf="menuOpen">
    <button
      type="button"
      class="settings-item"
      (click)="onUpdateProfile()"
    >
      Update profile
    </button>
  </div>
</div>

      </header>

      <div class="vp-layout">
        <aside class="vp-left">
          <div class="vp-avatar-wrap" *ngIf="p.picUrl">
            <img [src]="p.picUrl" [alt]="p.name + ' profile photo'" class="vp-avatar" />
          </div>

          <dl class="vp-list">
            <div class="vp-item">
              <dt>Gender</dt>
              <dd>{{ p.gender || '—' }}</dd>
            </div>

            <div class="vp-item">
              <dt>Birthday</dt>
              <dd>{{ formatBirthday(p.birthday) }}</dd>
            </div>

            <div class="vp-item">
              <dt>Language</dt>
              <dd>{{ p.language || '—' }}</dd>
            </div>

            <div class="vp-item">
              <dt>Occupation</dt>
              <dd>{{ p.occupation || '—' }}</dd>
            </div>

            <div class="vp-item">
              <dt>MBTI</dt>
              <dd>{{ p.mbti || '—' }}</dd>
            </div>

           <div class="vp-item" *ngIf="isOwner()">
              <dt>Height</dt>
              <dd>{{ p.height ? (p.height + ' cm') : '—' }}</dd>
            </div>

          </dl>
        </aside>

        <main class="vp-right">
          <section class="vp-section">
            <h2>About</h2>
            <p class="vp-bio">
              {{ p.bio || 'No bio added yet.' }}
            </p>
          </section>

          <section class="vp-section">
            <h2>Personality</h2>
            <p class="vp-text">
              {{ p.personality || 'Not specified' }}
            </p>
          </section>

          <section class="vp-section">
            <h2>Interests</h2>
            <div *ngIf="p.interests?.length; else noInterests" class="vp-chips">
              <span class="vp-chip" *ngFor="let i of p.interests">
                {{ i }}
              </span>
            </div>
            <ng-template #noInterests>
              <p class="vp-muted">No interests added yet.</p>
            </ng-template>
          </section>

          <section class="vp-section">
            <h2>Preferences</h2>
            <ul class="vp-tags">
              <li *ngIf="p.food"><strong>Comfort food:</strong> {{ p.food }}</li>
              <li *ngIf="p.vibe"><strong>Vibe:</strong> {{ p.vibe }}</li>
              <li *ngIf="p.music"><strong>Music:</strong> {{ p.music }}</li>
              <li *ngIf="p.movie"><strong>Movies:</strong> {{ p.movie }}</li>
              <li *ngIf="p.weather"><strong>Weather:</strong> {{ p.weather }}</li>
            </ul>
          </section>

          <section class="vp-section">
            <h2>Friendship</h2>
            <p class="vp-text">
              Looking for friends who value
              <strong>{{ p.friendQuality || '—' }}</strong>.
            </p>
          </section>
        </main>
      </div>
    </article>

  </ng-container>
</section>

<ng-template #loadingTpl>
  <div class="msg">Loading…</div>
</ng-template>

<ng-template #errTpl>
  <div class="msg error">{{ error() }}</div>
</ng-template>
