<section class="profile-container">
  <article class="profile-card">
    <header class="profile-header">
      <h1>Complete Your Profile</h1>
      <p>Feel free to update any details below.</p>
    </header>

    <form class="profile-form" [formGroup]="profileForm" (ngSubmit)="onSubmit()">
      <section class="profile-avatar-section">
        <div class="avatar-preview">
          <img [src]="profilePhoto()" alt="Profile avatar">
        </div>
        <div class="avatar-actions">
          <div class="pic-options">
            <label class="pic-option" *ngFor="let option of picPreferenceOptions">
              <input type="radio" formControlName="picPreference" name="picPreference" [value]="option.value"
                (change)="onPicPreferenceChange($event)">
              <span>{{ option.label }}</span>
            </label>
          </div>
          <div class="upload-field" *ngIf="profileForm.get('picPreference')?.value === 'upload'">
            <label class="upload-input">
              <span class="upload-button">Upload a new profile photo</span>
              <span class="upload-hint">
                {{ uploadedFileName() ? ('Selected file: ' + uploadedFileName()) : 'No file selected' }}
              </span>
              <input type="file" accept="image/*" (change)="onFileSelected($event)" [disabled]="isUploading()">
            </label>

            <div class="upload-status" *ngIf="isUploading()">
              Uploading image...
            </div>

            <span class="error" *ngIf="isInvalid('picFile')">Please upload an image.</span>
            <span class="error" *ngIf="uploadError()">{{ uploadError() }}</span>
          </div>
        </div>
      </section>

      <div class="grid">
        <label class="field">
          <span class="field-label">Display Name</span>
          <input type="text" formControlName="name" placeholder="Enter how you would like to be called">
          <span class="error" *ngIf="isInvalid('name')">Please enter a display name.</span>
        </label>

        <label class="field">
          <span class="field-label">Gender</span>
          <select formControlName="gender">
            <option value="" disabled>Select gender</option>
            <option *ngFor="let option of genderOptions" [value]="option">
              {{ option }}
            </option>
          </select>
          <span class="error" *ngIf="isInvalid('gender')">Please select a gender.</span>
        </label>

        <div class="field birthday-field">
          <span class="field-label">Birthday</span>
          <div class="birthday-selects">
            <select formControlName="birthdayYear" (change)="onBirthdayChange()">
              <option value="" disabled>Year</option>
              <option *ngFor="let year of yearOptions" [value]="year">{{ year }}</option>
            </select>
            <select formControlName="birthdayMonth" (change)="onBirthdayChange()">
              <option value="" disabled>Month</option>
              <option *ngFor="let month of monthOptions" [value]="month.value">
                {{ month.label }}
              </option>
            </select>
            <select formControlName="birthdayDay" (change)="onBirthdayChange()">
              <option value="" disabled>Day</option>
              <option *ngFor="let day of dayOptions" [value]="day">{{ day }}</option>
            </select>
          </div>
          <span class="helper" *ngIf="formattedBirthday()">Selected date: {{ formattedBirthday() }}</span>
          <span class="error"
            *ngIf="isInvalid('birthdayYear') || isInvalid('birthdayMonth') || isInvalid('birthdayDay')">
            Please complete the birthday selection.
          </span>
        </div>

        <label class="field">
          <span class="field-label">State</span>
          <select formControlName="state" (change)="onStateChange($event)">
            <option value="" disabled>Select state</option>
            <option *ngFor="let option of stateOptions" [value]="option">
              {{ option }}
            </option>
          </select>
          <span class="error" *ngIf="isInvalid('state')">Please select a state.</span>
        </label>

        <label class="field">
          <span class="field-label">City</span>
          <select formControlName="city" [disabled]="availableCities().length === 0">
            <option value="" disabled>Select city</option>
            <option *ngFor="let option of availableCities()" [value]="option">
              {{ option }}
            </option>
          </select>
          <span class="error" *ngIf="isInvalid('city')">Please select a city.</span>
        </label>

        <label class="field">
          <span class="field-label">Language</span>
          <select formControlName="language">
            <option value="" disabled>Select primary language</option>
            <option *ngFor="let option of languageOptions" [value]="option">
              {{ option }}
            </option>
          </select>
          <span class="error" *ngIf="isInvalid('language')">Please select a language.</span>
        </label>

        <label class="field">
          <span class="field-label">Occupation</span>
          <select formControlName="occupation">
            <option value="" disabled>Select occupation</option>
            <option *ngFor="let option of occupationOptions" [value]="option">
              {{ option }}
            </option>
          </select>
          <span class="error" *ngIf="isInvalid('occupation')">Please select an occupation.</span>
        </label>

        <label class="field">
          <span class="field-label">MBTI</span>
          <select formControlName="mbti">
            <option value="" disabled>Select MBTI type</option>
            <option *ngFor="let option of mbtiOptions" [value]="option">
              {{ option }}
            </option>
          </select>
          <span class="error" *ngIf="isInvalid('mbti')">Please select an MBTI type.</span>
        </label>

        <label class="field">
          <span class="field-label">Height</span>
          <div class="input-group mb-3">
            <input type="number" class="form-control" formControlName="height" aria-label="Height" min="1" />
            <span class="input-group-text">cm</span>
          </div>
          <span class="error" *ngIf="isInvalid('height')">Please select a height.</span>
        </label>

        <label class="field">
          <span class="field-label">Weight</span>
          <div class="input-group mb-3">
            <input type="number" class="form-control" formControlName="weight" aria-label="Weight" min="1">
            <span class="input-group-text">kg</span>
          </div>
          <span class="error" *ngIf="isInvalid('weight')">Please select a weight.</span>
        </label>

        <label class="field">
          <span class="field-label">Personality</span>
          <select formControlName="personality">
            <option value="" disabled>Select personality highlight</option>
            <option *ngFor="let option of personalityOptions" [value]="option">
              {{ option }}
            </option>
          </select>
          <span class="error" *ngIf="isInvalid('personality')">Please select a personality highlight.</span>
        </label>

        <div class="interests-block">
          <label class="form-label">Interests</label>
          <div class="d-flex flex-wrap gap-3">
            <div *ngFor="let interest of interestOptions; let i = index" class="form-check">
              <input class="form-check-input" type="checkbox" [id]="'interest-' + i" [value]="interest"
                [checked]="isInterestSelected(interest)" (change)="onInterestChange($event, interest)" />
              <label class="form-check-label" [for]="'interest-' + i">
                {{ interest }}
              </label>
            </div>
          </div>
          <span class="error" *ngIf="isInvalid('interests')">Please choose at least one interest.</span>
        </div>

        <div class="field field-full">
          <section class="profile-section preference-section">
            <h2>Personal Preferences</h2>
            <p class="section-hint">These help us understand your vibe better ðŸŒŸ</p>

            <label class="field" *ngFor="let question of preferenceQuestions">
              <span class="field-label">{{ question.label }}</span>
              <select [formControlName]="question.controlName">
                <option value="">{{ question.placeholder }}</option>
                <option *ngFor="let option of question.options">{{ option }}</option>
              </select>
            </label>
          </section>
        </div>

        <label class="field field-full">
          <span class="field-label">Bio</span>
          <textarea formControlName="bio" rows="4" maxlength="500" placeholder="Share a short introduction"></textarea>
          <span class="error" *ngIf="isInvalid('bio')">Please provide a short bio (max 500 characters).</span>
        </label>

      </div>

      <footer class="form-footer">
        <button type="button" (click)="onSubmit()" class="save-button" [disabled]="isSaving() || isUploading()">
          <span *ngIf="isSaving()">Savingâ€¦</span>
          <span *ngIf="isUploading()">Uploadingâ€¦</span>
          <span *ngIf="!isSaving() && !isUploading()">Save Profile</span>
        </button>

        <p class="success" *ngIf="showSuccess()">
          Profile saved successfully!
        </p>

        <p class="error" *ngIf="uploadError()">
          Error: {{ uploadError() }}
        </p>
      </footer>
    </form>
  </article>
</section>